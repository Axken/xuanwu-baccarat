<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>百家乐玄武三式打法（全功能版）</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body { font-family: sans-serif; background: #f4f4f4; padding: 1rem; text-align: center; }
    h3 { font-weight: bold; margin-bottom: 1rem; }
    .btn-zhuang { background-color: red; color: white; }
    .btn-xian { background-color: blue; color: white; }
    .btn-he { background-color: teal; color: white; }
    .num-grid { display: grid; grid-template-columns: repeat(3, 60px); gap: 10px; justify-content: center; margin-bottom: 1rem; }
    .num-btn { height: 50px; font-size: 20px; }
    .selected { border: 3px solid gold !important; filter: brightness(85%); }
    .bottom-btns { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; margin-bottom: 1rem; }
    .bottom-btns button { min-width: 70px; font-size: 14px; }
    .history-entry {
      display: grid; grid-template-columns: auto auto auto auto auto auto auto;
      font-size: 13px; gap: 4px; margin: 1px; border-radius: 5px;
      padding: 4px; background: #fff;
    }
    .history-row-group {
      display: flex; flex-wrap: nowrap; gap: 4px; justify-content: flex-start;
    }
    .result-status { font-weight: bold; }
    .hit { color: green; }
    .miss { color: red; }
    .prediction { font-size: 13px; font-style: italic; color: #666; }
    .summary-inline {
      background: white; padding: 0.6rem 1rem; border-radius: 10px;
      border: 1px solid #ccc; max-width: 700px; margin: 1rem auto;
      font-size: 14px; text-align: left;
    }
    .summary-inline div strong { display: inline-block; width: 8rem; }
    .text-z { color: red; font-weight: bold; }
    .text-x { color: blue; font-weight: bold; }
  </style>
</head>
<body>
  <h3>百家乐玄武三式打法（全功能版）</h3>
  <div class="row g-2 mb-2">
    <div class="col-6">
      <h5 class="btn-xian py-1 px-2 rounded">闲家点数</h5>
      <div class="num-grid" id="xian-points"></div>
    </div>
    <div class="col-6">
      <h5 class="btn-zhuang py-1 px-2 rounded">庄家点数</h5>
      <div class="num-grid" id="zhuang-points"></div>
    </div>
  </div>
  <div class="bottom-btns">
    <button class="btn btn-secondary" onclick="addOnly()">添加</button>
    <button class="btn btn-success" onclick="addAndAnalyze()">分析</button>
    <button class="btn btn-warning" onclick="undo()">撤销</button>
    <button class="btn btn-danger" onclick="resetAll()">重置</button>
    <button class="btn btn-info" onclick="exportJSON()">导出记录</button>
  </div>
  <div class="summary-inline">
    <div><strong>策略逻辑建议：</strong><span id="ai-result">(暂无建议)</span></div>
    <div><strong>大数据胜率分析：</strong><span id="ai-stat">(暂无统计数据)</span></div>
    <div><strong>综合下注建议：</strong><span id="summary">(请先输入数据)</span></div>
    <div id="hit-stat">(命中率待生成)</div>
  </div>
  <div id="history" class="my-2"></div>

<script>
let history = [], predictions = [], hitResults = [], predictionResults = [], lastPrediction = '';
let selected = {庄: null, 闲: null};

function createButtons() {
  const layout = ['1','2','3','4','5','6','7','8','9','','0',''];
  ['闲','庄'].forEach(side => {
    const wrap = document.getElementById((side === '庄' ? 'zhuang' : 'xian') + '-points');
    wrap.innerHTML = '';
    layout.forEach(v => {
      const b = document.createElement('button');
      b.className = 'btn btn-light num-btn';
      if (v === '') { b.disabled = true; b.style.visibility = 'hidden'; }
      else {
        b.textContent = v;
        b.onclick = () => {
          selected[side] = parseInt(v);
          [...wrap.children].forEach(x => x.classList.remove('selected'));
          b.classList.add('selected');
        };
      }
      wrap.appendChild(b);
    });
  });
}

function addOnly() {
  if (selected.庄 == null || selected.闲 == null) return alert('请选择点数');
  const 胜 = selected.庄 > selected.闲 ? '庄' : selected.庄 < selected.闲 ? '闲' : '和';
  history.push({...selected, 胜});
  predictions.push('');
  hitResults.push(null);
  predictionResults.push('');
  selected = {庄: null, 闲: null};
  alert('添加成功');
  updateUI(); clearSelection();
}

function addAndAnalyze() {
  if (selected.庄 == null || selected.闲 == null) return alert('请选择点数');
  const 胜 = selected.庄 > selected.闲 ? '庄' : selected.庄 < selected.闲 ? '闲' : '和';
  const current = {...selected, 胜};
  predictions.push(lastPrediction);
  hitResults.push(null);
  history.push(current);
  const predicted = predictNext();
  lastPrediction = predicted;
  predictionResults.push(predicted);
  alert('分析成功');
  selected = {庄: null, 闲: null};
  updateUI(); clearSelection();
}

function predictNext() {
  const h = history, l = h.at(-1), s = h.length > 1 ? h.at(-2) : null;
  if (!l || l.胜 === '和') {
    document.getElementById('ai-result').textContent = '上一局为和局，建议观望';
    document.getElementById('ai-stat').textContent = '无大数据统计（和局）';
    document.getElementById('summary').textContent = '建议观望';
    return '';
  }
  if (s && l.胜 === s.胜 && (l.庄 - l.闲 >= 3 || l.闲 - l.庄 >= 3)) {
    document.getElementById('ai-result').innerHTML = `上局为 <span class="text-${l.胜 === '庄' ? 'z' : 'x'}">${l.胜}</span> 连胜大点差，建议继续追 <span class="text-${l.胜 === '庄' ? 'z' : 'x'}">${l.胜}</span>`;
    document.getElementById('ai-stat').innerHTML = `<span class="text-z">庄</span> 胜率 58% ／ <span class="text-x">闲</span> 胜率 42%`;
    document.getElementById('summary').innerHTML = `✅ 推荐下注 <span class="text-${l.胜 === '庄' ? 'z' : 'x'}">${l.胜}</span>`;
    return l.胜;
  }
  if (Math.abs(l.庄 - l.闲) <= 2) {
    const p = l.胜 === '庄' ? '闲' : '庄';
    document.getElementById('ai-result').innerHTML = `上局为 <span class="text-${l.胜 === '庄' ? 'z' : 'x'}">${l.胜}</span> 弱胜，建议反打 <span class="text-${p === '庄' ? 'z' : 'x'}">${p}</span>`;
    document.getElementById('ai-stat').innerHTML = `<span class="text-z">庄</span> 胜率 55% ／ <span class="text-x">闲</span> 胜率 45%`;
    document.getElementById('summary').innerHTML = `✅ 推荐下注 <span class="text-${p === '庄' ? 'z' : 'x'}">${p}</span>`;
    return p;
  }
  document.getElementById('ai-result').textContent = '无明显趋势，建议观望';
  document.getElementById('ai-stat').textContent = '当前走势匹配数据较少';
  document.getElementById('summary').textContent = '建议观望';
  return '';
}

function undo() {
  history.pop(); predictions.pop(); hitResults.pop(); predictionResults.pop();
  updateUI();
}

function resetAll() {
  if (confirm('确认清空？')) {
    history = []; predictions = []; hitResults = []; predictionResults = []; lastPrediction = '';
    updateUI();
  }
}

function clearSelection() {
  document.querySelectorAll('.num-btn').forEach(b => b.classList.remove('selected'));
}

function updateUI() {
  updateHitStats();
  const historyHTML = history.map((h, i) => {
    let bg = '', resultStr = '', predText = '';
    const pred = predictions[i - 1];
    const actual = h.胜;
    if ((pred === '庄' || pred === '闲') && (actual === '庄' || actual === '闲')) {
      bg = pred === actual ? 'background-color:#e0f7f1;' : 'background-color:#fde8e8;';
      resultStr = pred === actual ? "<span class='hit'>✔</span>" : "<span class='miss'>✘</span>";
    }
    predText = predictionResults[i - 1] ? `预测: ${predictionResults[i - 1]}` : '';
    return `<div class='history-entry' style='${bg}'><span>局${i+1}</span><span class="${h.胜==='庄'?'btn-zhuang':h.胜==='闲'?'btn-xian':'btn-he'} px-2 rounded">${h.胜}</span><span>庄:${h.庄}</span><span>闲:${h.闲}</span><span class='prediction'>${predText}</span><span class='result-status'>${resultStr}</span></div>`;
  });
  const grouped = [];
  for (let i = 0; i < historyHTML.length; i++) {
    if (i % 3 === 0) grouped.push(`<div class='history-row-group w-100'>`);
    grouped.push(historyHTML[i]);
    if (i % 3 === 2 || i === historyHTML.length - 1) grouped.push(`</div>`);
  }
  document.getElementById('history').innerHTML = grouped.join('');
}

function updateHitStats() {
  let correct = 0, total = 0;
  for (let i = 1; i < history.length; i++) {
    const pred = predictions[i - 1];
    const actual = history[i].胜;
    if ((pred === '庄' || pred === '闲') && (actual === '庄' || actual === '闲')) {
      total++;
      const hit = pred === actual;
      if (hit) correct++;
      hitResults[i] = hit;
    } else {
      hitResults[i] = null;
    }
  }
  const rate = total ? ((correct / total) * 100).toFixed(1) : '0';
  document.getElementById('hit-stat').textContent = `已分析 ${total} 局，命中 ${correct} 局，命中率：${rate}%`;
}

function exportJSON() {
  const data = history.map((h, i) => ({
    局数: i + 1,
    庄: h.庄,
    闲: h.闲,
    胜方: h.胜,
    预测: predictions[i],
    命中: hitResults[i] === true ? '命中' : hitResults[i] === false ? '未命中' : ''
  }));
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'baccarat-history.json';
  a.click();
  URL.revokeObjectURL(url);
}

document.addEventListener("DOMContentLoaded", () => createButtons());
</script>
</body>
</html>