<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>百家乐玄武三式打法</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { font-family: sans-serif; background: #f4f4f4; padding: 1rem; text-align: center; }
    .num-grid {
      display: grid;
      grid-template-columns: repeat(3, 60px);
      gap: 10px;
      justify-content: center;
      margin-bottom: 1rem;
    }
    .num-btn { height: 50px; font-size: 20px; }
    .selected { border: 3px solid gold !important; filter: brightness(85%); }
    .bottom-btns {
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 1rem;
      z-index: 10;
      position: relative;
    }
    .bottom-btns button { min-width: 70px; font-size: 14px; }
    .history-entry {
      display: grid;
      grid-template-columns: auto auto auto auto auto;
      font-size: 13px;
      gap: 4px;
      margin: 1px;
      border-radius: 5px;
      padding: 4px;
      background: #fff;
    }
    .history-row-group {
      display: flex;
      flex-wrap: nowrap;
      gap: 4px;
      justify-content: flex-start;
    }
    .circle-small {
      width: 20px;
      height: 20px;
      line-height: 20px;
      border-radius: 50%;
      font-size: 12px;
      font-weight: bold;
      text-align: center;
      color: white;
      position: relative;
    }
    .tie-line::after {
      content: '';
      position: absolute;
      width: 100%;
      height: 2px;
      background-color: limegreen;
      top: 50%;
      left: 0;
      transform: rotate(45deg);
      transform-origin: center;
    }
    .z { background: red; }
    .x { background: blue; }
    .h { background: teal; }
    .summary-inline {
      background: white;
      padding: 0.6rem 1rem;
      border-radius: 10px;
      border: 1px solid #ccc;
      max-width: 700px;
      margin: 1rem auto;
      font-size: 14px;
      text-align: left;
    }
    .summary-inline div strong { display: inline-block; width: 8rem; }
    .text-z { color: red; font-weight: bold; }
    .text-x { color: blue; font-weight: bold; }
    .text-h { color: teal; font-weight: bold; }
    .btn-zhuang { background-color: red; color: white; }
    .btn-xian { background-color: blue; color: white; }
    .btn-he { background-color: teal; color: white; }
  </style>
</head>
<body>
  <h3>百家乐玄武三式打法</h3>

  <div class="row g-2 mb-2">
    <div class="col-6">
      <h5 class="btn-xian py-1 px-2 rounded">闲家点数</h5>
      <div class="num-grid" id="xian-points"></div>
    </div>
    <div class="col-6">
      <h5 class="btn-zhuang py-1 px-2 rounded">庄家点数</h5>
      <div class="num-grid" id="zhuang-points"></div>
    </div>
  </div>

  <div class="bottom-btns">
    <button class="btn btn-secondary" onclick="addOnly()">添加</button>
    <button class="btn btn-success" onclick="addAndAnalyze()">分析</button>
    <button class="btn btn-warning" onclick="undo()">撤销</button>
    <button class="btn btn-danger" onclick="resetAll()">重置</button>
  </div>

  <div class="summary-inline">
    <div><strong>策略逻辑建议：</strong><span id="ai-result"><span class="text-muted">（暂无建议）</span></span></div>
    <div><strong>大数据胜率分析：</strong><span id="ai-stat"><span class="text-muted">（暂无统计数据）</span></span></div>
    <div><strong>综合下注建议：</strong><span id="summary"><span class="text-muted">（请先输入数据）</span></span></div>
    <div id="hit-stat">（命中率待生成）</div>
  </div>

  <div id="history" class="my-2"></div>
  <div id="trend" class="mt-3"></div>

  <script>
    let history = [], predictions = [], selected = {庄: null, 闲: null};

    function createButtons() {
      const layout = ['1','2','3','4','5','6','7','8','9','','0',''];
      ['闲','庄'].forEach(side => {
        const wrap = document.getElementById((side === '庄' ? 'zhuang' : 'xian') + '-points');
        wrap.innerHTML = '';
        layout.forEach(v => {
          const b = document.createElement('button');
          b.className = 'btn btn-light num-btn';
          if (v === '') { b.disabled = true; b.style.visibility = 'hidden'; }
          else {
            b.textContent = v;
            b.onclick = () => {
              selected[side] = parseInt(v);
              [...wrap.children].forEach(x => x.classList.remove('selected'));
              b.classList.add('selected');
            };
          }
          wrap.appendChild(b);
        });
      });
    }

    function clearSelection() {
      document.querySelectorAll('.num-btn').forEach(b => b.classList.remove('selected'));
    }

    function addOnly() {
      if (selected.庄 == null || selected.闲 == null) return alert('请选择点数');
      const 胜 = selected.庄 > selected.闲 ? '庄' : selected.闲 > selected.庄 ? '闲' : '和';
      history.push({...selected, 胜});
      predictions.push('');
      selected = {庄: null, 闲: null};
      updateUI(); clearSelection();
    }

    function undo() {
      history.pop(); predictions.pop(); updateUI();
      document.getElementById('ai-result').textContent = '(暂无建议)';
      document.getElementById('ai-stat').textContent = '(暂无统计数据)';
      document.getElementById('summary').textContent = '(请先输入数据)';
      document.getElementById('hit-stat').textContent = '';
    }

    function resetAll() {
      if (confirm('确认清空？')) {
        history = []; predictions = [];
        updateUI();
        document.getElementById('ai-result').textContent = '(暂无建议)';
        document.getElementById('ai-stat').textContent = '(暂无统计数据)';
        document.getElementById('summary').textContent = '(请先输入数据)';
        document.getElementById('hit-stat').textContent = '';
      }
    }

    function generateDaLuTrend(history) {
      const maxRow = 6;
      let grid = [], trendMap = [];
      let col = -1, row = 0;

      for (let i = 0; i < history.length; i++) {
        const curr = history[i];
        const type = curr.胜;
        const value = type === '庄' ? curr.庄 : type === '闲' ? curr.闲 : '和';

        if (type === '和') {
          if (trendMap.length > 0) {
            const last = trendMap.at(-1);
            if (!grid[last.col][last.row].tie) {
              grid[last.col][last.row].tie = true;
            }
          }
          continue;
        }

        const prev = trendMap.at(-1);
        const same = prev && prev.type === type;

        if (!same) { col++; row = 0; }
        else if (row + 1 < maxRow && !(grid[col]?.[row + 1])) { row++; }
        else { col++; row = 0; }

        if (!grid[col]) grid[col] = [];
        grid[col][row] = { type, value, tie: false };
        trendMap.push({ col, row, type });
      }

      let html = `<div style="display:flex; gap:4px;">`;
      for (let c = 0; c < grid.length; c++) {
        html += `<div style="display:flex; flex-direction:column; gap:4px;">`;
        for (let r = 0; r < maxRow; r++) {
          const cell = grid[c]?.[r];
          if (cell) {
            const cls = `${cell.type === '庄' ? 'z' : cell.type === '闲' ? 'x' : 'h'}${cell.tie ? ' tie-line' : ''}`;
            html += `<div class="circle-small ${cls}">${cell.value}</div>`;
          } else {
            html += `<div style="width:20px;height:20px;"></div>`;
          }
        }
        html += `</div>`;
      }
      html += `</div>`;
      return html;
    }

    function updateUI() {
      const historyHTML = history.map((h, i) => {
        const cls = h.胜 === '庄' ? 'btn-zhuang' : h.胜 === '闲' ? 'btn-xian' : 'btn-he';
        return `<div class='history-entry'><span>局${i+1}</span><span class="${cls} px-2 rounded">${h.胜}</span><span>庄:${h.庄}</span><span>闲:${h.闲}</span></div>`;
      });
      const grouped = [];
      for (let i = 0; i < historyHTML.length; i++) {
        if (i % 3 === 0) grouped.push(`<div class='history-row-group w-100'>`);
        grouped.push(historyHTML[i]);
        if (i % 3 === 2 || i === historyHTML.length - 1) grouped.push(`</div>`);
      }
      document.getElementById('history').innerHTML = grouped.join('');
      document.getElementById('trend').innerHTML = generateDaLuTrend(history);
    }

    function addAndAnalyze() {
      if (selected.庄 == null || selected.闲 == null) return alert('请选择点数');
      const 胜 = selected.庄 > selected.闲 ? '庄' : selected.闲 > selected.庄 ? '闲' : '和';
      history.push({...selected, 胜});
      predictions.push('');
      selected = {庄: null, 闲: null};
      updateUI(); clearSelection();
    }

    window.onload = () => createButtons();
  </script>
</body>
</html>
